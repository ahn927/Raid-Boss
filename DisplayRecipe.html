<!DOCTYPE html>
<html lang="en">

<head>
  <title>Op project team</title>
  <meta charset="utf-8" />
  <style>
    #getJSON,
    #getHTML {
      background-color: #fabc89;
      width: 50%;
      margin: .5em;
      padding: 1em;
    }

    #p1 {
      font-size: 14pt;
      height: 18pt;
      color: red;
      font-weight: bold;
    }

    table {
      border: 2px red solid;
    }

    th {
      background-color: aqua;
      font-weight: bold;
    }

    tr:nth-child(odd) {
      background-color: yellow;

    }

    tr:nth-child(even) {
      background-color: orange;
    }

    a {
      text-decoration:none!important;
    }
    
    a:hover {
      text-decoration:none!important;
    }
    .recipeID{
      text-decoration:none;
    }


  </style>
</head>

<body>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <div>
    <p id='p1'></p>
  </div>
  <div id="getJSON">
    <a href='#'>Click here to get the list of recipes with ur given ingredients</a>
  </div>

  <div id="jsonTable">
      <div class="col-sm-4">
    <p><a href='#'class="recipeID"></p></a><img class = "images">
        <p class = "recipeNumber"></p>
    <p><a href='#'class="recipeID"></p></a><img class = "images"> 
      <p class = "recipeNumber"></p>
    <p><a href='#'class="recipeID"></p></a><img class = "images"> <!-- src= "stuff" alt="something went wrong!"> -->
      <p class = "recipeNumber"></p>
    </div>
    <div class="col-sm-4">
    <p><a href='#'class="recipeID"></p></a><img class = "images"> 
      <p class = "recipeNumber"></p>
    <p><a href='#'class="recipeID"></p></a><img class = "images">
     <p class = "recipeNumber"></p>
    <p><a href='#'class="recipeID"></p></a><img class = "images">
     <p class = "recipeNumber"></p>
  </div>
  </div>

  <!-- not needed anymore -->
  <div id = "ingredientsList"></div> 
  <div id = "steps"></div>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script>

    /*<![CDATA[*/
    $(document).ready(function () {

      //FOR THE ACTUAL PROJECT, THE VALUES INSIDE THE ARRAY WILL COME FROM USER CLICKING ICONS (UP TO 5).
      var ingredients = ["egg", "bread", "", "",""];  

      $('#getJSON a').click(function (e) {
        // don't allow the anchor to visit the link
        e.preventDefault();
        console.log('clicked for JSON');

        $.ajax({
          url: "GetRecipeID.php",
          dataType: "json",
          type: "GET",
          data: { output: 'json' , ingredients: ingredients },
          success: function (data) {
            // get each item
            //console.log(data);
            //var listData = "";
            var items = data;
            console.log("printing items" + items);
            console.log(data["body"]);
            console.log("data: " + data);

            var x = 0;
            var listData = "<table><tr><th>ID</th><th>Item Name</th><th>Item Description</th><th>Price</th><th>Quantity</th></tr>";

            //Loops through all the recipeID classes, and sets the recipe title for each.
            $('.recipeID').each(function (i, $this) {
              if ((items["body"][x]) != null) {
                console.log((items["body"][x]));
                $(this).text(items["body"][x]["title"] + " and ID: " + items["body"][x]["id"]);
                $(this).attr('id', items["body"][x]["id"]);
                //$(this).addClass(items["body"][x]["id"]);
                //$(this).attr('src', items["body"][x]["image"]);
              }
              x++;
            });

            x = 0;
            
            //loops through all the recipeID classes, and sets the images for each...
            $('.images').each(function (i, $this) {
              if ((items["body"][x]) != null) {
                console.log((items["body"][x]));
                $(this).text(items["body"][x]["image"]);
                $(this).attr('src', items["body"][x]["image"]);
                //$(this).attr('class', items["body"][x]["id"]);
                //$(this).addClass(items["body"][x]["id"]);
               // console.log("this should be 977701: " + $(this).attr("class"));
              }
              x++;
            }); 

            x = 0;
            //Loops through all the recipeNumber classes (paragraph element), and changes the class name
            //to the recipe id for future reference
            $('.recipeNumber').each(function (i, $this) {
              if ((items["body"][x]) != null) {
                console.log((items["body"][x]));
                $(this).attr('class', items["body"][x]["id"]);
                //$(this).addClass(items["body"][x]["id"]);
                //$(this).attr('src', items["body"][x]["image"]);
              }
              x++;
            });

            x = 0;

              /*
            for (var i in items) { //change this to "for (var i in items["body"]), then i["id"], i['title], etc... 
              console.log("the value of i is: " + i);
              listData += "<tr><td>" + items["body"][x]["id"] + "</td><td>" + items["body"][x]["title"]
                + "</td><td>" + items["body"][x]["image"] + "</td><td>" + items['Price'] + "</td><td>" + items['Quantity']; + "</td></tr></table>"
              console.log("value is: " + items["body"][x]["id"]);
              //$("#id1").text(items["body"][x]["id"]);
              x++;
            } */

            //$("#jsonTable").append(listData);

          },
          error: function (jqXHR, textStatus, errorThrown) {
            $("#p1").text(textStatus + " " + errorThrown
              + jqXHR.responseText);
          }
        });
      });

    });
    /*]]>*/


$(document).ready(function () {

$('.recipeID').click(function (e) {
  // don't allow the anchor to visit the link
  e.preventDefault();
  console.log('clicked to get recipe info');
  var clickedElement = this;

  $.ajax({
    url: "GetRecipeInfo.php",
    dataType: "json",
    type: "GET",
    data: { output: 'json', id: $(this).attr("id") },
    success: function (data) {

      var dataBody = data["body"][0];

      console.log("printing items" + data);
      console.log(data["body"][0]);
      console.log("data steps: " + data["body"][0]["steps"][0]["step"]);
      console.log("data steps length: " + data["body"][0]["steps"].length);
      //console.log("data steps: " + data[0]["steps"]["step"]);
      
       //APPENDS THE INGREDIENTS LIST WITHOUT ADDING DUPLICATE INGREDIENTS

      $("." + $(clickedElement).attr("id")).append("<b>Ingredients needed:</b> ");
      var ingredientsNeeded = "";
      for (var i = 0; i < dataBody["steps"].length; i++ ){
        for (var j = 0; j < dataBody["steps"][i]["ingredients"].length; j++){
          console.log("ingredients needed: " + dataBody["steps"][i]["ingredients"][j]["name"]);  
          if (ingredientsNeeded.indexOf(dataBody["steps"][i]["ingredients"][j]["name"]) == -1 ){
            ingredientsNeeded += (dataBody["steps"][i]["ingredients"][j]["name"] + ", ");
            console.log("ingredients needed is: " + ingredientsNeeded);
          }
          else {
            console.log("duplicate ingredient: " + dataBody["steps"][i]["ingredients"][j]["name"]);
          }
        }
      } 
      $("." + $(clickedElement).attr("id")).append(ingredientsNeeded);
      $("." + $(clickedElement).attr("id")).append("</br>");

      //APPENDS THE RECIPE STEPS
      $("." + $(clickedElement).attr("id")).append("<b>Here is the list of steps:</b> </br>" );
      for(var i = 0; i < dataBody["steps"].length; i++  ){
        console.log("Step " + (parseInt(i) + 1) + ": " + dataBody["steps"][i]["step"]);
        console.log("the class to search: " + $(clickedElement).attr("id"));
        //$("#steps").append("Step " + i + ": " + dataBody["steps"][i]["step"] + "</br>");
        $("." + $(clickedElement).attr("id")).append("Step " + (parseInt(i) + 1) + ": " + dataBody["steps"][i]["step"] + "</br>");
      }
      

    },
    error: function (jqXHR, textStatus, errorThrown) {
      $("#p1").text(textStatus + " " + errorThrown
        + jqXHR.responseText);
    }
  });
});

});  
  </script>

</body>

</html>