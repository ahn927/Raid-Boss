<!DOCTYPE html>
<html lang="en">
<head>
  <title> TapNCook </title>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="./desktop.css">
  <link href="https://fonts.googleapis.com/css?family=PT+Sans|Lily+Script+One|Oleo+Script+Swash+Caps:700" rel="stylesheet">
</head>

<body>
  <!-- Bootstrap stuff!-->
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

  <!-- Nav Bar -->
  <div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <a class="links" href="./index.html">Home</a>
    <a class="links" href="./AboutUs.html">About Us</a>
    <a class="links" href="./AffiliatedApps.html">Affiliated Apps</a>
    <a class="links" href="./login.html">Login</a>
    <a class="links" href="./signup.html">Sign Up</a>
    <a class="links" href="./bait.html">Don't Click</a>
  </div>
  <div id="cover" onclick="closeNav()">
  </div>
  <!-- nav bar ends-->
  
  <div id="header"> 
        <div id="menuDiv">
        <span id = menuIcon style="font-size:80px;cursor:pointer;" onclick="openNav()">&#9776;</span>
        </div>
        <a href="./index.html" style="text-decoration : none;"><p>Tap'N CooK</p></a>
  </div>
  <div style="width:10%; float:left;"></div>
  <section class="wrapper">
    <div class="container-fostrap">
        <div>
            <h1 class="heading">
                Here are some recipes for you lazy fucks ^.^
            </h1>
        </div>
        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="card">
                                <a class="img-card">
                                        <img class ="recipe_image" src="./icon/banana.png" />
                                      </a>
                            <div class="card-content">
                                <p class="recipe_title">
                                </p>
                                <p class="recipe_ingredient"></p>
                            </div>
                            <div class="card-read-more">
                                <a href="http://www.fostrap.com/2016/03/bootstrap-3-carousel-fade-effect.html" class="btn btn-link btn-block">
                                    Read More
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="card">
                            <a class="img-card">
                            <img class ="recipe_image" src="./icon/banana.png" />
                          </a>
                            <div class="card-content">
                                <p class="recipe_title">
                                  </p>
                                <p class="recipe_ingredient"></p>
                            </div>
                            <div class="card-read-more">
                                <a href="http://www.fostrap.com/2016/03/bootstrap-3-carousel-fade-effect.html" class="btn btn-link btn-block">
                                    Read More
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="card">
                            <a class="img-card">
                            <img class ="recipe_image" src="./icon/banana.png" />
                          </a>
                            <div class="card-content">
                                <p class="recipe_title">
                                  </p>
                                <p class="recipe_ingredient"></p>
                            </div>
                            <div class="card-read-more">
                                <a href="http://www.fostrap.com/2016/03/bootstrap-3-carousel-fade-effect.html" class="btn btn-link btn-block">
                                    Read More
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="card">
                            <a class="img-card">
                            <img class ="recipe_image" src="/icon/banana.png" />
                          </a>
                            <div class="card-content">
                                <p class="recipe_title">
                                  </p>
                                <p class="recipe_ingredient"></p>
                            </div>
                            <div class="card-read-more">
                                <a class="btn btn-link btn-block">
                                    Read More
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="card">
                            <a class="img-card">
                            <img class ="recipe_image" src="./icon/banana.png" />
                          </a>
                            <div class="card-content">
                                <p class="recipe_title">
                                  </p>
                                <p class="recipe_ingredient"></p>
                            </div>
                            <div class="card-read-more">
                                <a href="http://www.fostrap.com/2016/03/bootstrap-3-carousel-fade-effect.html" class="btn btn-link btn-block">
                                    Read More
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="card">
                            <a class="img-card">
                            <img class ="recipe_image" src="./icon/banana.png" />
                          </a>
                            <div class="card-content">
                                <p class="recipe_title">
                                  </p>
                                <p class="recipe_ingredient"></p>
                            </div>
                            <div class="card-read-more">
                                <a href="http://www.fostrap.com/2016/03/bootstrap-3-carousel-fade-effect.html" class="btn btn-link btn-block">
                                    Read More
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </section>

  <!--********** modal start **********-->
  <div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">Image preview</h4>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        </div>
        <div class="modal-body">
          <img src="" id="imagepreview" style="width: 100%;">
          <p class="information">Information</p>
          <p class="infomration_content"></p>
          <p class="ingredient">Ingredient</p>
          <p class="ingredient_content"></p>
          <p class="instructions">Instructions</p>
          <p class="instructions_content"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    /*<![CDATA[*/
    $(document).ready(function () {
      //modal pops up
      $(".recipe_image").on("click", function() {
       $('#imagepreview').attr('src', $(this).attr('src')); // here asign the image to the modal when the user click the enlarge link
       $('#imagemodal').modal('show'); // imagemodal is the id attribute assigned to the bootstrap modal, then i use the show function
       $('.modal-title').text($(this).attr('text'));
      });
      var counter = 0;
      var ingredients = ["turkey", "", "", "", ""];
        $.ajax({
          url: "GetRecipeID.php",
          dataType: "json",
          type: "GET",
          data: {
            output: 'json',
            ingredients: ingredients
          },
          success: function (data) {
            var items = data;
            console.log(items);
           //assigning unique id and attribute for each card
           var x = 0;
           $(".recipe_ingredient").each(function(){
                if(items["body"][x] !=null) {
                    $(this).attr('id', 'ingredient_' + items['body'][x]['id']);
                }
            });
            x = 0;

            $(".card").each(function(){
                if ((items["body"][x]) != null) {
                    $(this).attr('id', items["body"][x]["id"]);
                    //console.log($(this).attr('id'));
                }
                x++;
                counter++;
                console.log(counter);
            });
            x = 0;

            $(".recipe_image").each(function(){
                if ((items["body"][x]) != null) {
                    $(this).attr('id', items["body"][x]["id"]);
                    $(this).attr('src', items["body"][x]["image"]);
                    $(this).attr('text', items['body'][x]['title']);
                }
                x++;
            });

            x = 0;
            $(".recipe_title").each(function(){
                if ((items["body"][x]) != null) {
                    $(this).attr('id', 'title_' + items["body"][x]["id"]);
                    $(this).text(items["body"][x]["title"]);
                }
                x++;
            });

            while(true){
            console.log("---" + counter);
                if (counter == 6){
                    $(".card").each(function(){
                        var individual_card = $(this);
                        $.ajax({
                            url: "GetRecipeInfo.php",
                            dataType: "json",
                            type: "GET",
                            data: {
                                output: 'json',
                                id: $(this).attr("id")
                            },
                            success: function (data) {
                                //console.log("this id " + $(individual_card).attr('id'));
                                var dataBody = data["body"][0];
                                var ingredientsNeeded = new Array();
                                /*console.log(dataBody);
                                console.log("--------------------");*/
                                if (data["body"][0] != undefined){
                                    for (var i = 0; i < dataBody["steps"].length; i++) {
                                        for (var j = 0; j < dataBody["steps"][i]["ingredients"].length; j++) {
                                            if (!ingredientsNeeded.includes(dataBody["steps"][i]["ingredients"][j]["name"])) {
                                                ingredientsNeeded.push(dataBody["steps"][i]["ingredients"][j]["name"]);
                                            } else {
                                                console.log("duplicate ingredient: " + dataBody["steps"][i]["ingredients"][j]["name"]);
                                            }
                                        }
                                    }
                                }
                                else {
                                ingredientsNeeded = "Sorry, no recipe instructions can be obtained. ";
                                //console.log("databody not defined!");
                                }
                                console.log(ingredientsNeeded); 
                                $("#ingredient_" + $(individual_card).attr('id')).text(ingredientsNeeded);
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                $("#header").text(textStatus + " " + errorThrown +
                                jqXHR.responseText);
                                }
                            });
                        }); return;
                    }
            }
          },
          error: function (jqXHR, textStatus, errorThrown) {
            $("#header").text(textStatus + " " + errorThrown +
              jqXHR.responseText);
          }
        });
        console.log(counter); 
        // recipe instruction & ingredient is imported from here
    

        /*while(true){
            console.log(counter);
            if (counter == 6){
                $(".card").each(function(){
                    $.ajax({
                        url: "GetRecipeInfo.php",
                        dataType: "json",
                        type: "GET",
                        data: {
                            output: 'json',
                            id: $(this).attr("id")
                        },
                        success: function (data) {
                            //console.log("this id " + $(individual_card).attr('id'));
                            var dataBody = data["body"][0];
                            var ingredientsNeeded = new Array();
                            /*console.log(dataBody);
                            console.log("--------------------");*//*
                            if (data["body"][0] != undefined){
                                for (var i = 0; i < dataBody["steps"].length; i++) {
                                    for (var j = 0; j < dataBody["steps"][i]["ingredients"].length; j++) {
                                        if (!ingredientsNeeded.includes(dataBody["steps"][i]["ingredients"][j]["name"])) {
                                            ingredientsNeeded.push(dataBody["steps"][i]["ingredients"][j]["name"]);
                                        } else {
                                            console.log("duplicate ingredient: " + dataBody["steps"][i]["ingredients"][j]["name"]);
                                        }
                                    }
                                }
                            }
                            else {
                            ingredientsNeeded = "Sorry, no recipe instructions can be obtained. ";
                            //console.log("databody not defined!");
                            }
                            console.log(ingredientsNeeded); 
                            $("#ingredient_" + $(this).attr('id')).text(ingredientsNeeded);
                            },
                        error: function (jqXHR, textStatus, errorThrown) {
                            $("#header").text(textStatus + " " + errorThrown +
                            jqXHR.responseText);
                            }
                    });
                }); return;
            }
        }*/
    });
        console.log($(".card").attr('id'));
  </script>
</body>
</html>