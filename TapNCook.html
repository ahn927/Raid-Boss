<!DOCTYPE html>
<html lang="en">
<head>
  <title> TapNCook </title>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="basicStyle.css" />
  <link href="https://fonts.googleapis.com/css?family=PT+Sans|Lily+Script+One|Oleo+Script+Swash+Caps:700" rel="stylesheet">
</head>

<body>

  <!-- Bootstrap stuff!-->
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

  <header>
    Tap'N CooK
  </header>

  <!-- Nav Bar -->
  <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="./TapNCook.html">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="./AboutUs.html">About Us</a>
      </li>
    </ul>
    <div class="dropdown">
        <button type="button" class="btn btn-primary dropdown-toggle bg-secondary" data-toggle="dropdown">
          More Features
        </button>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="./login.html">Login</a>
          <a class="dropdown-item" href="#">Sign Up</a>
          <a class="dropdown-item" href="#">Settings</a>
        </div>
      </div>
  </nav>

  
  <div id="whole">
    <p id="subhead">What do you want to use?</p>
    <div class="icons">
      <img id="carrot" src="icon/carrot.png" alt="broken" />
      <p>Carrot</p>
    </div>
    <div class="icons">
      <img id="lettuce" src="icon/lettuce.png" alt="broken" />
      <p>Lettuce</p>
    </div>
    <div class="icons">
      <img id="cheese" src="icon/cheese%20(1).png" alt="broken" />
      <p>Cheese</p>
    </div>
    <div class="icons">
      <img id="banana" src="icon/banana.png" alt="broken" />
      <p>Banana</p>
    </div>
    <div class="icons">
       <img id = "tomato" src = "icon/tomato.png" alt = "broken"/>
			 <p>Tomato</p></div>
    <div class="icons">
       <img id = "bread" src = "icon/toast.png" alt = "broken"/>
			 <p>Bread</p>
    </div>
    <div id="basket">
      <p>Basket</p>
      <img id="bcarrot" class="dhide" src="icon/carrot.png" alt="broken" />
      <img id="blettuce" class="dhide" src="icon/lettuce.png" alt="broken" />
      <img id="bcheese" class="dhide" src="icon/cheese%20(1).png" alt="broken" />
      <img id="bbanana" class="dhide" src="icon/banana.png" alt="broken" />
      <img id = "btomato" class = "dhide" src = "icon/tomato.png" alt = "broken"/>
      <img id = "bbread" class = "dhide" src = "icon/toast.png" alt = "broken"/>
      <img id="arrow" src="icon/whitearrow.png" />
    </div>

    <div id="footer">
      <div id="bcitdiv">
      <a href = "https://www.bcit.ca/" target="blank">
        <img src = "logos/192px-BCITwordmark.svg.png" id = "bcit"/>
      </a>
      </div>  
      <div id="loveFooddiv">
      <a href="https://www.lovefoodhatewaste.com/" target="blank">
      <img src = "logos/logo_og.png" id = "loveFood"/>
      </a>
      </div>
      <div id="metroVandiv">
      <a href="http://www.metrovancouver.org/" target="blank">
      <img src = "logos/MV-DefaultLockup_RGB_05157.png" id = "metro"/>
      </a>
      </div>
    </div>

    </div>
  <div id = "menu">
      <div class="row">
      <div class="col-sm-4">
          <p><a href='#'class="recipeID"></p></a><img class = "images">
              <p class = "recipeNumber"></p>
          <p><a href='#'class="recipeID"></p></a><img class = "images"> 
            <p class = "recipeNumber"></p>
          <p><a href='#'class="recipeID"></p></a><img class = "images"> <!-- src= "stuff" alt="something went wrong!"> -->
            <p class = "recipeNumber"></p>
          </div>
          <div class="col-sm-4">
          <p><a href='#'class="recipeID"></p></a><img class = "images"> 
            <p class = "recipeNumber"></p>
          <p><a href='#'class="recipeID"></p></a><img class = "images">
           <p class = "recipeNumber"></p>
          <p><a href='#'class="recipeID"></p></a><img class = "images">
           <p class = "recipeNumber"></p>
        </div>
      </div>

  </div>

  
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

  <script>
    /*<![CDATA[*/
    $(document).ready(function () {

      var ingredients = ["", "", "", "", ""];
      var count = 0;
      $("#carrot").click(function () {
        $("#bcarrot").show(500);
        $("#carrot").css("filter", "grayscale(100%)");
        $("#arrow").show(500);
        ingredients[count] = "carrot";
        count++;
      });
      $("#lettuce").click(function () {
        $("#blettuce").show(500);
        $("#lettuce").css("filter", "grayscale(100%)");
        $("#arrow").show(500);
        ingredients[count] = "lettuce";
        count++;
      });
      $("#cheese").click(function () {
        $("#bcheese").show(500);
        $("#cheese").css("filter", "grayscale(100%)");
        $("#arrow").show(500);
        ingredients[count] = "cheese";
        count++;
      });
      $("#banana").click(function () {
        $("#bbanana").show(500);
        $("#banana").css("filter", "grayscale(100%)");
        $("#arrow").show(500);
        ingredients[count] = "banana";
        count++;
      });
      $("#tomato").click(function() {
              $("#btomato").show(500);
              $("#tomato").css("filter" , "grayscale(100%)");
              $("#arrow").show(500);
              ingredients[count] = "tomato";
              count++;
            console.log(ingredients + count);
          });
       $("#bread").click(function() {
              $("#bbread").show(500);
              $("#bread").css("filter" , "grayscale(100%)");
              $("#arrow").show(500);
              ingredients[count] = "bread";
              count++;
            console.log(ingredients + count);
          });
        /*****************************************/
        /*********removal functionality **********/
        /*****************************************/
        $("#bcarrot").click(function() {
              count--;
              $("#bcarrot").hide(500);
              $("#carrot").css("filter" , "");
              for(let i = 0; i < ingredients.length;i++) {
                if (ingredients[i] == "carrot"){
                  ingredients[i]="";
                  var removedIndex = i;
                  console.log(removedIndex);
                }
              }
              for(var i = ingredients.length - 1; i > removedIndex;i--) {
                console.log(ingredients[i] + count);
                if (ingredients[i] != ""){
                  ingredients[removedIndex] = ingredients[i];
                  ingredients[i] = "";
                  break;
                }
              }
              console.log(ingredients);
              removeArrow();
          });
          $("#blettuce").click(function() {
            count--;
              $("#blettuce").hide(500);
              $("#lettuce").css("filter" , "");
              for(let i = 0; i < ingredients.length;i++) {
                if (ingredients[i] == "lettuce"){
                  ingredients[i]="";
                  var removedIndex = i;
                  console.log(removedIndex);
                }
              }
              for(var i = ingredients.length - 1; i > removedIndex;i--) {
                console.log(ingredients[i] + count);
                if (ingredients[i] != ""){
                  ingredients[removedIndex] = ingredients[i];
                  ingredients[i] = "";
                  break;
                }
              }
              removeArrow();
            console.log(ingredients);
          });
          $("#bcheese").click(function() {
            count--;
              $("#bcheese").hide(500);
              $("#cheese").css("filter" , "");
              for(let i = 0; i < ingredients.length;i++) {
                if (ingredients[i] == "cheese"){
                  ingredients[i]="";
                  var removedIndex = i;
                  console.log(removedIndex);
                }
              }
              for(var i = ingredients.length - 1; i > removedIndex;i--) {
                console.log(ingredients[i] + count);
                if (ingredients[i] != ""){
                  ingredients[removedIndex] = ingredients[i];
                  ingredients[i] = "";
                  break;
                }
              }
              removeArrow();
            console.log(ingredients);
          });
          $("#bbanana").click(function() {
            count--;
              $("#bbanana").hide(500);
              $("#banana").css("filter" , "");
              for(let i = 0; i < ingredients.length;i++) {
                if (ingredients[i] == "banana"){
                  ingredients[i]="";
                  var removedIndex = i;
                  console.log(removedIndex);
                }
              }
              for(var i = ingredients.length - 1; i > removedIndex;i--) {
                console.log(ingredients[i] + count);
                if (ingredients[i] != ""){
                  ingredients[removedIndex] = ingredients[i];
                  ingredients[i] = "";
                  break;
                }
              }
              removeArrow();
            console.log(ingredients);
          });
          $("#btomato").click(function() {
            count--;
              $("#btomato").hide(500);
              $("#tomato").css("filter" , "");
              for(let i = 0; i < ingredients.length;i++) {
                if (ingredients[i] == "tomato"){
                  ingredients[i]="";
                  var removedIndex = i;
                  console.log(removedIndex);
                }
              }
              for(var i = ingredients.length - 1; i > removedIndex;i--) {
                console.log(ingredients[i] + count);
                if (ingredients[i] != ""){
                  ingredients[removedIndex] = ingredients[i];
                  ingredients[i] = "";
                  break;
                }
              }
              removeArrow();
            console.log(ingredients);
          });
          $("#bbread").click(function() {
            count--;
              $("#bbread").hide(500);
              $("#bread").css("filter" , "");
              for(let i = 0; i < ingredients.length;i++) {
                if (ingredients[i] == "bread"){
                  ingredients[i]="";
                  var removedIndex = i;
                  console.log(removedIndex);
                }
              }
              for(var i = ingredients.length - 1; i > removedIndex;i--) {
                console.log(ingredients[i] + count);
                if (ingredients[i] != ""){
                  ingredients[removedIndex] = ingredients[i];
                  ingredients[i] = "";
                  break;
                }
              }
              removeArrow();
            console.log(ingredients);
          });
          var removeArrow = function(){
            var isEmpty = true;
            for (let i = 0 ; i < ingredients.length; i++){
              if (ingredients[i] != "") {
                isEmpty = false;
                break;
              } else {
                isEmpty = true;
              }
            }
            if(isEmpty == true){
                $("#arrow").hide(500);
              }
          }
        /*****************************************/
        /*********removal functionality end*******/
        /*****************************************/
      $("#arrow").click(function () {
        $("#whole").hide(500);
        $("#menu").show(500);
      
        $.ajax({
          url: "GetRecipeID.php",
          dataType: "json",
          type: "GET",
          data: {
            output: 'json',
            ingredients: ingredients
          },
          success: function (data) {
            var items = data;

            var x = 0;

            //Loops through all the recipeID classes, and sets the recipe title for each.
            $('.recipeID').each(function (i, $this) {
              if ((items["body"][x]) != null) {
                $(this).text(items["body"][x]["title"] /*+ " and ID: " + items["body"][x]["id"]*/ );
                $(this).attr('id', items["body"][x]["id"]);
              }
              x++;
            });

            x = 0;

            //loops through all the recipeID classes, and sets the images for each
            $('.images').each(function (i, $this) {
              if ((items["body"][x]) != null) {
                $(this).text(items["body"][x]["image"]);
                $(this).attr('src', items["body"][x]["image"]);
              }
              x++;
            });

            x = 0;
            //Loops through all the recipeNumber classes (paragraph element), and changes the class name
            //to the recipe id for future reference
            $('.recipeNumber').each(function (i, $this) {
              if ((items["body"][x]) != null) {
                $(this).attr('class', items["body"][x]["id"]);
              }
              x++;
            });

          },
          error: function (jqXHR, textStatus, errorThrown) {
            $("#p1").text(textStatus + " " + errorThrown +
              jqXHR.responseText);
          }
        });
      });

      $('.recipeID').click(function (e) {
        // don't allow the anchor to visit the link
        e.preventDefault();
        console.log('clicked to get recipe info');
        var clickedElement = this;

        $.ajax({
          url: "GetRecipeInfo.php",
          dataType: "json",
          type: "GET",
          data: {
            output: 'json',
            id: $(this).attr("id")
          },
          success: function (data) {

            var dataBody = data["body"][0];

            //APPENDS THE INGREDIENTS LIST TO THE PARAGRAPH ELEMENT WITH CLASS NAME = RECIPE ID, WITHOUT ADDING DUPLICATE INGREDIENTS
            $("." + $(clickedElement).attr("id")).append("<b>Ingredients needed:</b> ");
            var ingredientsNeeded = "";
            for (var i = 0; i < dataBody["steps"].length; i++) {
              for (var j = 0; j < dataBody["steps"][i]["ingredients"].length; j++) {
                if (ingredientsNeeded.indexOf(dataBody["steps"][i]["ingredients"][j]["name"]) == -1) {
                  ingredientsNeeded += (dataBody["steps"][i]["ingredients"][j]["name"] + ", ");
                } else {
                  console.log("duplicate ingredient: " + dataBody["steps"][i]["ingredients"][j]["name"]);
                }
              }
            }
            $("." + $(clickedElement).attr("id")).append(ingredientsNeeded);
            $("." + $(clickedElement).attr("id")).append("</br>");

            //APPENDS THE RECIPE STEPS
            $("." + $(clickedElement).attr("id")).append("<b>Here is the list of steps:</b> </br>");
            for (var i = 0; i < dataBody["steps"].length; i++) {
              $("." + $(clickedElement).attr("id")).append("Step " + (parseInt(i) + 1) + ": " + dataBody[
                "steps"][i]["step"] + "</br>");
            }


          },
          error: function (jqXHR, textStatus, errorThrown) {
            $("#p1").text(textStatus + " " + errorThrown +
              jqXHR.responseText);
          }
        });
      });
    });

    /*]]>*/
  </script>

</body>

</html>